<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PiZZA Master</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#CD212A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app" v-cloak>

    <div v-if="atualizandoApp" class="update-screen">
        <div class="pizza-loader"><i class="fas fa-pizza-slice"></i><div class="progress-bar"><div class="fill"></div></div><p>ATUALIZANDO...</p></div>
    </div>

    <div v-if="mostrarNovidades" class="modal-backdrop">
        <div class="modal-window">
            <div class="modal-top"><h3>{{ fullVersion }}</h3></div>
            <div class="modal-content">
                <ul class="news-list">
                    <li><i class="fas fa-id-badge"></i> <strong>Cargos Definidos:</strong> Configure Pizzaiolo, Atendente ou Gerente.</li>
                    <li><i class="fas fa-paint-brush"></i> <strong>Visual Premium:</strong> Interface com as cores da Itália.</li>
                    <li><i class="fas fa-shield-alt"></i> <strong>Segurança:</strong> Sistema de login blindado.</li>
                </ul>
                <button class="btn-primary full" @click="fecharNovidades">BORA!</button>
            </div>
        </div>
    </div>

    <div v-if="mostrarSucesso" class="success-overlay fade-in">
        <div class="success-card">
            <div class="checkmark-circle"><div class="checkmark draw"></div></div><h3>Salvo!</h3>
        </div>
    </div>

    <div v-if="!sessaoAtiva" class="login-screen">
        <div class="italy-stripe-top"></div>
        <div class="brand-box">
            <div class="logo-circle"><i class="fas fa-pizza-slice"></i></div>
            <h1 class="italy-text">PiZZA <span>Mas</span><i>ter</i></h1>
        </div>
        
        <div class="login-card" :class="{ 'shake-error': loginErro }">
            <div class="input-group"><i class="fas fa-user"></i><input type="text" v-model="loginUser" placeholder="Usuário"></div>
            <div class="input-group"><i class="fas fa-lock"></i><input type="password" v-model="loginPass" placeholder="PIN" maxlength="4" inputmode="numeric"></div>
            <button @click="efetuarLogin" class="btn-entrar">ENTRAR</button>
            <p v-if="msgAuth" class="error-msg" style="color:red; margin-top:10px; font-weight:bold;">{{ msgAuth }}</p>
        </div>

        <div class="login-footer">
            <p class="version">{{ fullVersion }}</p>
            <p class="terms-link" @click="mostrandoTermos = true">Termos de Uso</p>
        </div>
        <div class="italy-stripe-bottom"></div>
    </div>

    <div v-else class="app-layout">
        <header class="app-header">
            <div class="header-inner">
                <i class="fas fa-chevron-left" v-if="telaAtiva" @click="voltarInicio"></i>
                <h2>{{ tituloTela }}</h2>
                <div class="user-badge" @click="telaAtiva = 'config'"><span>{{ usuarioLogado.nome }}</span><i class="fas fa-cog"></i></div>
            </div>
        </header>

        <div v-if="!telaAtiva" class="menu-grid">
            <button v-for="bloco in blocosPermitidos" :key="bloco.id" :class="['menu-card', bloco.cor]" @click="abrirBloco(bloco.id)">
                <i :class="bloco.icon"></i><span>{{ bloco.nome }}</span>
            </button>
            <button class="menu-card gray" @click="mostrandoHistorico = true"><i class="fas fa-history"></i><span>HISTÓRICO</span></button>
            <button class="menu-card dark" @click="telaAtiva = 'config'"><i class="fas fa-tools"></i><span>AJUSTES</span></button>
        </div>

        <div v-if="telaAtiva === 'gelo'" class="gelo-area">
            <div class="gelo-card">
                <i class="fas fa-cube big-icon"></i><h3>Gelo</h3><p>Meta: <strong>8 Sacos</strong></p>
                <div class="input-gelo-wrapper"><input type="number" v-model.number="qtdGeloAtual" placeholder="0"></div>
            </div>
            <button class="btn-primary full mt-10" @click="enviarPedidoGelo">ENVIAR</button>
        </div>

        <div v-if="telaAtiva === 'config'" class="config-area">
            <button class="btn-danger-ghost full" @click="logout">SAIR DO APP</button>
        </div>
    </div>

    <div v-if="mostrandoResumo" class="modal-backdrop">
        <div class="modal-window">
            <div class="modal-top"><h3>Resumo</h3></div>
            <div class="modal-content">
                <pre class="whatsapp-preview">{{ textoWhatsApp }}</pre>
                <button class="btn-whatsapp full" @click="enviarWhatsApp">ENVIAR WHATSAPP</button>
            </div>
        </div>
    </div>

</div>

<script src="script.js"></script>
</body>
</html>