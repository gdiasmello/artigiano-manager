<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/192/008C45/FFFFFF?text=Artigiano">
    <title>Artigiano Gest√£o</title>
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-[#F4F4F4]">
    <div id="app" v-cloak>
        
        <div v-if="loading" class="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white">
            <div class="loader-italy"></div>
            <button v-if="showForcedEnter" @click="loading = false" class="mt-8 px-6 py-2 bg-red-600 text-white rounded-full font-bold">ENTRAR FOR√áADO</button>
        </div>

        <div v-if="!authenticated" class="fixed inset-0 z-50 flex items-center justify-center bg-white p-6">
            <div class="w-full max-w-sm glass-card p-8 text-center" :class="{ 'shake-error': loginError }">
                <h1 class="text-2xl font-bold text-[#008C45] mb-6">Artigiano <span class="text-[#CD212A]">Gest√£o</span></h1>
                <input type="password" v-model="pinInput" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="ios-input text-center text-3xl tracking-[15px] mb-4" :class="{ 'error-border': loginError }" maxlength="4" inputmode="numeric">
                <button @click="login" class="ios-btn bg-[#008C45] w-full text-white">Acessar Painel</button>
            </div>
        </div>

        <main v-if="authenticated" class="pb-24">
            <header class="p-6 pt-12 glass-nav sticky top-0 z-40 mb-4 border-b border-gray-200">
                <h2 class="text-xl font-bold">üì¶ Gest√£o de Estoque</h2>
                <p class="text-xs opacity-60">{{ dataAtualFormatada }} | Meta: {{ metaHoje }}</p>
            </header>

            <div class="px-4 space-y-4">
                <div class="glass-card p-4">
                    <h3 class="font-bold mb-4 flex justify-between">Contagem Multi-Local</h3>
                    <div v-for="item in estoque" :key="item.id" class="mb-6 p-3 bg-white/50 rounded-xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-gray-800">{{ item.nome }}</span>
                            <span class="text-sm px-2 py-1 bg-gray-100 rounded-lg">Fator: {{ item.fatorConversao }}x</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <input type="number" v-model="item.locais.geladeira" placeholder="Geladeira" class="ios-input-small">
                            <input type="number" v-model="item.locais.freezer" placeholder="Freezer" class="ios-input-small">
                        </div>
                        <div class="mt-3 flex justify-between text-sm">
                            <span class="text-gray-500">Total Un: <strong>{{ somarUnidades(item) }}</strong></span>
                            <span class="text-[#CD212A] font-bold">Para Compra: {{ calcularCompra(item) }}</span>
                        </div>
                    </div>
                </div>

                <div class="glass-card overflow-hidden">
                    <div @click="toggleSetor('adm')" class="p-4 bg-gray-50 flex justify-between font-bold">
                        <span>Painel Administrativo</span>
                        <span>{{ setores.adm ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-show="setores.adm" class="p-4 space-y-4">
                        <div v-for="item in estoque" class="flex items-center gap-2 border-b pb-2">
                            <input v-model="item.nome" class="flex-1 text-sm p-1 border-b">
                            <select v-model="item.fornecedor" class="text-xs p-1">
                                <option v-for="f in fornecedores" :value="f">{{ f }}</option>
                            </select>
                            <button @click="removerItem(item)" class="text-red-500 p-2">‚úï</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="fixed bottom-20 left-4 right-4">
                <button @click="salvarFirebase" class="ios-btn bg-[#008C45] w-full text-white shadow-xl">
                    Finalizar e Sincronizar
                </button>
            </div>

            <nav class="fixed bottom-0 inset-x-0 h-16 glass-nav border-t flex justify-around items-center">
                <button @click="abrirTermos" class="text-xs font-bold text-gray-400 uppercase">Termos de Uso</button>
                <button @click="authenticated = false" class="text-xs font-bold text-[#CD212A] uppercase">Sair</button>
            </nav>
        </main>

        <div v-if="modalTermos" class="fixed inset-0 z-[60] bg-black/60 flex items-center justify-center p-6 backdrop-blur-md">
            <div class="bg-white rounded-[22px] p-6 w-full max-w-sm">
                <h2 class="text-lg font-bold mb-4 border-b pb-2">Termos Profissionais</h2>
                <div class="text-xs text-gray-500 space-y-2 leading-relaxed h-48 overflow-y-auto">
                    <p>O desenvolvedor <strong>Gabriel</strong> det√©m a responsabilidade de suporte exclusivamente durante seu v√≠nculo com a Artigiano Pizzaria.</p>
                    <p>Fica estabelecida a <strong>isen√ß√£o total</strong> de responsabilidade sobre confer√™ncia de pedidos, valores financeiros ou erros de log√≠stica.</p>
                    <p>O uso do PIN 1821 √© de responsabilidade do administrador.</p>
                </div>
                <button @click="modalTermos = false" class="ios-btn bg-gray-100 w-full mt-4">Entendi</button>
            </div>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
