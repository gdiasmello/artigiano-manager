<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Artigiano Master</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-[#F2F2F7]">
    <div id="app" v-cloak>
        
        <div v-if="!authenticated" class="fixed inset-0 z-50 flex items-center justify-center bg-white p-6">
            <div class="w-full max-w-sm glass-card p-8 text-center" :class="{ 'shake-error': loginError }">
                <h1 class="text-3xl font-black text-[#008C45] mb-2">ARTIGIANO</h1>
                <p class="text-[10px] tracking-[3px] text-gray-400 uppercase mb-8">Gest√£o de Insumos</p>
                
                <select v-model="userSelected" class="ios-input mb-4 font-bold text-center appearance-none">
                    <option value="" disabled>QUEM EST√Å ACESSANDO?</option>
                    <option v-for="u in equipe" :value="u">{{ u.nome }}</option>
                </select>
                <input type="password" v-model="pinInput" placeholder="PIN" class="ios-input text-center text-2xl tracking-[10px] mb-6" maxlength="4" inputmode="numeric">
                <button @click="login" class="ios-btn bg-[#008C45] w-full text-white">Entrar</button>
            </div>
        </div>

        <main v-if="authenticated && currentTab === 'home'" class="p-6 pt-12">
            <header class="mb-8">
                <h2 class="text-2xl font-black">Ciao, {{ userSelected.nome }}</h2>
                <p class="text-sm text-gray-500">Hoje √© {{ dataAtual }}</p>
            </header>

            <div class="grid grid-cols-2 gap-4">
                <div v-if="podeVer('insumos')" @click="currentTab = 'insumos'" class="tile-apple bg-[#008C45] text-white">
                    <span class="text-3xl">üì¶</span><span class="font-bold text-xs mt-2 uppercase">Insumos</span>
                </div>
                <div v-if="podeVer('historico')" @click="currentTab = 'historico'" class="tile-apple bg-white text-gray-800 border">
                    <span class="text-3xl">üìú</span><span class="font-bold text-xs mt-2 uppercase">Hist√≥rico</span>
                </div>
                <div v-if="userSelected.cargo === 'ADM' || userSelected.cargo === 'Gerente'" @click="currentTab = 'config'" class="tile-apple bg-[#CD212A] text-white">
                    <span class="text-3xl">‚öôÔ∏è</span><span class="font-bold text-xs mt-2 uppercase">Configura√ß√µes</span>
                </div>
                <div @click="logout" class="tile-apple bg-gray-200 text-gray-500">
                    <span class="text-3xl">üö™</span><span class="font-bold text-xs mt-2 uppercase">Sair</span>
                </div>
            </div>
        </main>

        <section v-if="currentTab === 'config'" class="min-h-screen pb-20">
            <header class="p-6 bg-white/80 backdrop-blur sticky top-0 z-30 flex justify-between items-center border-b">
                <button @click="currentTab = 'home'" class="text-[#008C45] font-bold">‚Üê Voltar</button>
                <h3 class="font-black text-sm uppercase">Painel de Controle</h3>
                <div class="w-10"></div>
            </header>

            <div class="p-4 space-y-4">
                
                <div class="glass-section">
                    <div @click="toggleSub('equipa')" class="section-header">
                        <span>üë• Gest√£o de Equipa</span>
                        <span>{{ sub.equipa ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-show="sub.equipa" class="p-4 space-y-4">
                        <div v-for="f in equipe" class="flex items-center justify-between bg-gray-50 p-3 rounded-2xl">
                            <div>
                                <p class="font-bold text-sm">{{ f.nome }} ({{ f.pin }})</p>
                                <p class="text-[10px] text-gray-400 uppercase">{{ f.cargo }}</p>
                            </div>
                            <button @click="removerFuncionario(f)" class="text-red-500 text-xs font-bold">Remover</button>
                        </div>
                        <button @click="adicionarFuncionario" class="ios-btn-small">+ Novo Funcion√°rio</button>
                    </div>
                </div>

                <div class="glass-section">
                    <div @click="toggleSub('fornecedores')" class="section-header">
                        <span>üöõ Fornecedores (WhatsApp)</span>
                        <span>{{ sub.fornecedores ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-show="sub.fornecedores" class="p-4 space-y-4">
                        <div v-for="forn in fornecedores" class="bg-gray-50 p-3 rounded-2xl space-y-2">
                            <input v-model="forn.nome" class="w-full text-sm font-bold bg-transparent">
                            <input v-model="forn.zap" placeholder="5543..." class="w-full text-xs text-gray-500 bg-transparent">
                            <label class="flex items-center gap-2 text-[10px] font-bold text-[#008C45]">
                                <input type="checkbox" v-model="forn.triplicaSexta"> üöÄ TRIPLICA NA SEXTA
                            </label>
                        </div>
                    </div>
                </div>

                <div class="glass-section">
                    <div @click="toggleSub('catalogo')" class="section-header">
                        <span>üçï Cat√°logo T√©cnico</span>
                        <span>{{ sub.catalogo ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-show="sub.catalogo" class="p-4">
                        <input v-model="searchCat" placeholder="üîç Autocomplete..." class="ios-input-small mb-4">
                        <div v-for="p in filteredCatalog" class="border-b border-gray-100 py-3">
                            <div class="flex justify-between items-center mb-2">
                                <input v-model="p.nome" class="text-sm font-bold w-full bg-transparent">
                                <button @click="removerItem(p)" class="text-red-300">√ó</button>
                            </div>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="flex flex-col">
                                    <span class="text-[9px] text-gray-400">FATOR</span>
                                    <input type="number" v-model="p.fator" class="bg-gray-100 p-1 rounded text-xs">
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-[9px] text-gray-400">META</span>
                                    <input type="number" v-model="p.meta" class="bg-gray-100 p-1 rounded text-xs">
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-[9px] text-gray-400">UNID.</span>
                                    <input v-model="p.unidade" class="bg-gray-100 p-1 rounded text-xs">
                                </div>
                            </div>
                        </div>
                        <button @click="novoProduto" class="ios-btn-small mt-4">Adicionar ao Cat√°logo</button>
                    </div>
                </div>

                <div class="glass-section">
                    <div @click="toggleSub('ajustes')" class="section-header">
                        <span>üóìÔ∏è Feriados & Rota F√≠sica</span>
                        <span>{{ sub.ajustes ? '‚àí' : '+' }}</span>
                    </div>
                    <div v-show="sub.ajustes" class="p-4 space-y-4">
                        <div class="flex justify-between items-center bg-red-50 p-3 rounded-2xl">
                            <span class="text-xs font-bold text-red-600">AUMENTO FERIADO (50%)</span>
                            <input type="checkbox" v-model="config.modoFeriado">
                        </div>
                        <div class="space-y-2">
                            <p class="text-[10px] font-bold text-gray-400 uppercase">Ordem de Contagem</p>
                            <div v-for="(rota, idx) in config.rota" class="flex justify-between bg-white p-2 rounded-xl text-xs shadow-sm">
                                <span>{{ idx + 1 }}. {{ rota }}</span>
                                <div class="flex gap-2">
                                    <button @click="moverRota(idx, -1)">‚ñ≤</button>
                                    <button @click="moverRota(idx, 1)">‚ñº</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <div v-if="modalTermos" class="fixed inset-0 z-[60] bg-black/50 backdrop-blur-sm flex items-center justify-center p-6">
            <div class="bg-white rounded-[32px] p-8 w-full max-w-sm">
                <h2 class="text-xl font-black mb-4">Termos de Uso</h2>
                <p class="text-[11px] text-gray-500 leading-relaxed mb-6">
                    Desenvolvedor: <strong>Gabriel</strong>.<br>
                    Responsabilidade de suporte limitada ao v√≠nculo profissional. Isen√ß√£o total de responsabilidade sobre valores e confer√™ncia de pedidos.
                </p>
                <button @click="modalTermos = false" class="ios-btn bg-gray-100 w-full text-black">Fechar</button>
            </div>
        </div>

    </div>
    <script src="script.js"></script>
</body>
</html>
