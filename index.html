<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Artigiano Gest√£o v2</title>
    
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body class="bg-[#F8F8F8]">
    <div id="app" v-cloak>
        
        <div v-if="!authenticated" class="fixed inset-0 z-50 flex items-center justify-center bg-white p-6">
            <div class="w-full max-w-sm glass-card p-8 text-center" :class="{ 'shake-error': loginError }">
                <div class="mb-6">
                    <h1 class="text-3xl font-black text-[#008C45]">ARTIGIANO</h1>
                    <p class="text-[10px] tracking-[4px] text-gray-400 uppercase">Gest√£o de Log√≠stica</p>
                </div>

                <select v-model="userSelected" class="ios-input mb-4 text-center font-bold appearance-none">
                    <option value="" disabled>SELECIONE SEU USU√ÅRIO</option>
                    <option v-for="u in usuarios" :value="u">{{ u.nome }} ({{ u.cargo }})</option>
                </select>

                <input type="password" v-model="pinInput" placeholder="PIN" class="ios-input text-center text-2xl tracking-[10px] mb-6" :class="{ 'error-border': loginError }" maxlength="4" inputmode="numeric">
                
                <button @click="login" class="ios-btn bg-[#008C45] w-full text-white shadow-xl">Acessar Sistema</button>
            </div>
        </div>

        <div v-if="authenticated && currentTab === 'home'" class="p-6 pt-16">
            <header class="mb-8">
                <h2 class="text-2xl font-black text-gray-800">Ciao, {{ userSelected.nome }}!</h2>
                <p class="text-sm text-gray-400">O que vamos gerenciar hoje?</p>
            </header>

            <div class="grid grid-cols-2 gap-4">
                <div @click="currentTab = 'insumos'" class="tile-apple bg-[#008C45] text-white">
                    <span class="text-3xl mb-2">üì¶</span>
                    <span class="font-bold uppercase text-[12px]">Insumos</span>
                </div>
                <div @click="currentTab = 'config'" class="tile-apple bg-white text-gray-800 border border-gray-100">
                    <span class="text-3xl mb-2">‚öôÔ∏è</span>
                    <span class="font-bold uppercase text-[12px]">Ajustes</span>
                </div>
                <div @click="enviarWhatsappGeral" class="tile-apple bg-[#CD212A] text-white">
                    <span class="text-3xl mb-2">üí¨</span>
                    <span class="font-bold uppercase text-[12px]">Pedidos</span>
                </div>
                <div @click="authenticated = false" class="tile-apple bg-gray-200 text-gray-500">
                    <span class="text-3xl mb-2">üö™</span>
                    <span class="font-bold uppercase text-[12px]">Sair</span>
                </div>
            </div>
        </div>

        <div v-if="authenticated && currentTab === 'insumos'" class="min-h-screen">
            <header class="p-6 pt-12 glass-nav sticky top-0 z-40 flex justify-between items-center">
                <button @click="currentTab = 'home'" class="text-[#008C45] font-bold">‚Üê Voltar</button>
                <h2 class="font-black uppercase tracking-tighter">Estoque de Insumos</h2>
                <div class="w-10"></div>
            </header>

            <div class="p-4">
                <input v-model="searchQuery" placeholder="üîç Buscar insumo..." class="ios-input mb-6 shadow-sm">

                <div class="space-y-4">
                    <div v-for="item in filteredInsumos" :key="item.id" class="glass-card p-4">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h4 class="font-bold text-gray-800">{{ item.nome }}</h4>
                                <p class="text-[10px] text-gray-400">Fornecedor: {{ item.fornecedor }}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-[10px] font-bold text-[#CD212A]">META: {{ item.meta }}</span>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 p-2 rounded-xl">
                                <label class="text-[9px] block text-center mb-1 font-bold">GELADEIRA</label>
                                <input type="number" v-model="item.locais.geladeira" class="w-full bg-transparent text-center font-bold">
                            </div>
                            <div class="bg-gray-50 p-2 rounded-xl">
                                <label class="text-[9px] block text-center mb-1 font-bold">FREEZER</label>
                                <input type="number" v-model="item.locais.freezer" class="w-full bg-transparent text-center font-bold">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="fixed bottom-6 inset-x-4">
                <button @click="gerarListaWhatsApp" class="ios-btn bg-[#008C45] w-full text-white shadow-2xl">
                    Gerar Lista de Pedidos
                </button>
            </div>
        </div>

        <div v-if="authenticated && currentTab === 'config'" class="p-4 pt-12">
            <header class="flex justify-between items-center mb-8 px-2">
                <button @click="currentTab = 'home'" class="text-[#008C45] font-bold">‚Üê Voltar</button>
                <h2 class="font-black">CONFIGURA√á√ïES</h2>
                <div class="w-8"></div>
            </header>

            <section class="glass-card p-4 mb-6">
                <h3 class="text-xs font-bold text-gray-400 mb-4 uppercase">Gerenciar Insumos & Contatos</h3>
                <div v-for="item in estoque" class="border-b border-gray-100 py-3 space-y-2">
                    <div class="flex gap-2">
                        <input v-model="item.nome" class="text-sm font-bold flex-1 bg-gray-50 p-1 rounded">
                        <input v-model="item.contato" placeholder="Zap (DDI+DDD+Num)" class="text-[10px] w-32 bg-gray-50 p-1 rounded">
                    </div>
                    <div class="flex gap-2">
                        <select v-model="item.fornecedor" class="text-[10px] flex-1">
                            <option v-for="f in fornecedores" :value="f">{{ f }}</option>
                        </select>
                        <input type="number" v-model="item.meta" placeholder="Meta" class="text-[10px] w-16 bg-gray-50 p-1 rounded text-center">
                    </div>
                </div>
                <button @click="adicionarItem" class="mt-4 w-full border-2 border-dashed border-gray-200 p-3 rounded-2xl text-xs font-bold text-gray-400">+ NOVO INSUMO</button>
            </section>
        </div>

    </div>
    <script src="script.js"></script>
</body>
</html>
